@page "/store"
@using Varta.Store.Client.Services
@inject IProductService ProductService

<PageTitle>Магазин - VARTA</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16 mb-16 pt-8">

    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-2" Style="font-weight: bold; color: white; text-transform: uppercase;">
        КАТАЛОГ ТОВАРІВ
    </MudText>

    @if (_isLoading)
    {
    <MudGrid>
        @for (int i = 0; i < 8; i++) { <MudItem xs="12" sm="6" md="3"><MudSkeleton Height="280px" /></MudItem> }
    </MudGrid>
    }
    else
    {
    <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true"
             PanelClass="mt-8"
             Color="Color.Transparent" SliderColor="Color.Warning" Centered="true"
             Class="compact-tabs">

        <MudTabPanel Text="ВСІ ТОВАРИ">
            <MudGrid>
                @foreach (var product in _products)
                {
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <Varta.Store.Client.Components.ProductCard Product="product" />
                </MudItem>
                }
            </MudGrid>
        </MudTabPanel>

        @foreach (var category in _categories)
        {
        <MudTabPanel Text="@category.ToUpper()">
            <MudGrid>
                @foreach (var product in _products.Where(p => p.CategoryName == category))
                {
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <Varta.Store.Client.Components.ProductCard Product="product" />
                </MudItem>
                }
            </MudGrid>
        </MudTabPanel>
        }
    </MudTabs>
    }
</MudContainer>

@code {
private List<ProductDto> _products = new();
private List<string> _categories = new();
private bool _isLoading = true;

protected override async Task OnInitializedAsync()
{
await Task.Delay(300);
_products = await ProductService.GetAllProducts();
_categories = _products.Select(p => p.CategoryName).Distinct().ToList();
_isLoading = false;
}
}

<style>
    /* Стиль кнопок */
    .compact-tabs .mud-tab {
        min-width: unset !important;
        padding: 6px 12px !important;
        min-height: 36px !important;
        font-size: 0.8rem !important;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Стиль сірої смуги (Toolbar) */
    .compact-tabs .mud-tabs-toolbar {
        min-height: 36px !important;
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.05);
    }

    /* ЗМІНА 2: Окремий стиль для контейнера з картками (Panels).
       Якщо PanelClass="mt-8" буде замало, цей стиль точно спрацює.
    */
    .compact-tabs .mud-tabs-panels {
        margin-top: 40px !important; /* ТУТ МИ РОБИМО ВІДСТУП */
    }

    .mud-tab-active {
        color: #ff9800 !important;
    }
</style>