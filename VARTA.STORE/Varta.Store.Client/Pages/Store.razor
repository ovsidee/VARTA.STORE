@page "/store"
@using Varta.Store.Client.Services
@inject IProductService ProductService
@using Microsoft.AspNetCore.Authorization
@attribute [AllowAnonymous]

<PageTitle>Магазин - VARTA</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16 mb-16 pt-4">

    <MudText Typo="Typo.h3" Align="Align.Center" Class="mb-6 animate-fade-in" 
             Style="font-weight: 900; color: white; text-transform: uppercase; letter-spacing: 2px;">
        КАТАЛОГ ТОВАРІВ
    </MudText>

    @if (_isLoading)
    {
        <MudGrid>
            @for (int i = 0; i < 8; i++) { <MudItem xs="12" sm="6" md="3"><MudSkeleton Height="320px" Class="rounded-lg" /></MudItem> }
        </MudGrid>
    }
    else
    {
        <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true"
                 PanelClass="mt-8"
                 Color="Color.Transparent" 
                 SliderColor="Color.Warning" 
                 Centered="true"
                 Class="modern-tabs animate-fade-in">

            <MudTabPanel Text="ВСІ ТОВАРИ">
                <MudGrid Class="mt-4">
                    @foreach (var product in _products)
                    {
                        <MudItem xs="12" sm="6" md="4" lg="3">
                            <Varta.Store.Client.Components.ProductCard Product="product" />
                        </MudItem>
                    }
                </MudGrid>
            </MudTabPanel>

            @foreach (var category in _categories)
            {
                <MudTabPanel Text="@category.ToUpper()">
                    <MudGrid Class="mt-4">
                        @foreach (var product in _products.Where(p => p.CategoryName == category))
                        {
                            <MudItem xs="12" sm="6" md="4" lg="3">
                                <Varta.Store.Client.Components.ProductCard Product="product" />
                            </MudItem>
                        }
                    </MudGrid>
                </MudTabPanel>
            }
        </MudTabs>
    }
</MudContainer>

@code {
    private List<ProductDto> _products = new();
    private List<string> _categories = new();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(300);
        _products = await ProductService.GetAllProducts();
        _categories = _products.Select(p => p.CategoryName).Distinct().ToList();
        _isLoading = false;
    }
}

<style>
    /* === MODERN TABS STYLING === */
    
    .modern-tabs .mud-tab {
        color: #8c8c8c !important;
        font-weight: 700 !important;
        font-size: 0.85rem !important;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        padding: 12px 24px !important;
        min-width: auto !important;
    }

    .modern-tabs .mud-tab:hover {
        color: #e0e0e0 !important;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }

    .modern-tabs .mud-tab-active {
        color: #ff9800 !important;
        background-color: rgba(255, 152, 0, 0.1) !important;
        border-radius: 8px;
    }

    .modern-tabs .mud-tabs-toolbar .mud-tabs-slider {
        display: none !important; 
    }

    .modern-tabs .mud-tabs-toolbar {
        background-color: transparent !important;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    /* Fade In Animation */
    .animate-fade-in {
        animation: fadeIn 0.8s ease-out;
    }

    /* FIX: Doubled the @@ symbol here */
    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>