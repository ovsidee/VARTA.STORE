@page "/servers"
@using Varta.Store.Shared
@inject ISnackbar Snackbar
@inject IJSRuntime JSRuntime
@inject IServerTagService ServerTagService

<PageTitle>Сервери - VARTA</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16 mb-16" Style="padding-top: 40px;">

    <MudText Typo="Typo.h3" Align="Align.Center" Class="mb-8 animate-fade-in"
        Style="font-weight: 900; letter-spacing: 2px; text-transform: uppercase;">
        СЕРВЕРИ
    </MudText>

    @if (_isLoading)
    {
        <MudGrid Justify="Justify.FlexStart">
            @for (int i = 0; i < 3; i++)
            {
                <MudItem xs="12" md="6">
                    <MudSkeleton Height="400px" Class="rounded-lg" />
                    <MudSkeleton Height="40px" Width="60%" Class="mt-4 rounded" />
                </MudItem>
            }
        </MudGrid>
    }
    else
    {
        <MudGrid Justify="@(_servers != null && _servers.Count == 1 ? Justify.Center : Justify.FlexStart)" Class="animate-fade-in">
            @if (_servers != null)
            {
                @foreach (var server in _servers)
                {
                    <MudItem xs="12" md="@(_servers.Count == 1 ? 8 : 6)">

                        <MudCard Elevation="4" Class="server-card rounded-lg overflow-hidden" Style="background-color: #1e1e2d;">

                            <div class="relative" style="line-height: 0;">
                                <!-- Using a placeholder or existing image if available. -->
                                @if (!string.IsNullOrEmpty(server.ImageUrl))
                                {
                                    <MudCardMedia Image="@($"images/{server.ImageUrl}")" Height="300" Class="server-image" />
                                }
                                else
                                {
                                    <MudCardMedia Image="images/servers/server1.png" Height="300" Class="server-image" />
                                }

                                <div class="server-overlay"></div>

                            </div>

                            <MudCardContent Class="pa-6" Style="background-color: #1e1e2d;">
                                <div class="d-flex justify-space-between align-center">

                                    <div @onclick="() => CopyToServerClipboard(server.IpAddress)" style="cursor: pointer;"
                                        title="Click to copy IP">
                                        <MudText Typo="Typo.h5" Style="font-weight: 800; color: white;">
                                            @server.Name
                                        </MudText>

                                        <MudText Typo="Typo.body2" Class="mud-text-secondary mt-1 copy-hover">
                                            IP: @server.IpAddress (Натисни щоб скопіювати)
                                        </MudText>
                                    </div>

                                    <MudIconButton OnClick="() => CopyToServerClipboard(server.IpAddress)"
                                        Icon="@Icons.Material.Filled.ContentCopy" Variant="Variant.Filled" Color="Color.Warning"
                                        Size="Size.Large" Class="ml-4" />
                                </div>
                            </MudCardContent>
                        </MudCard>

                    </MudItem>
                }
            }
        </MudGrid>
    }
</MudContainer>

<style>
    .server-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #333;
    }

    .server-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        border-color: #ff9800;
    }

    .server-image {
        transition: transform 0.5s ease;
    }

    .server-card:hover .server-image {
        transform: scale(1.05);
    }

    .copy-hover {
        transition: color 0.2s;
    }

    .server-card:hover .copy-hover {
        color: #ff9800 !important;
    }

    /* Fade In Animation */
    .animate-fade-in {
        animation: fadeIn 0.8s ease-out;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

@code {
    private List<ServerTag>? _servers;
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(300);
        _servers = await ServerTagService.GetServerTags();
        _isLoading = false;
    }

    private async Task CopyToServerClipboard(string? ip)
    {
        if (string.IsNullOrEmpty(ip)) return;

        await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", ip);
        Snackbar.Add("IP скопійовано в буфер обміну!", Severity.Success);
    }
}
